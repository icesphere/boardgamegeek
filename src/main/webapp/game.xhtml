<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<ui:composition template="/templates/commonLayout.xhtml">
    <ui:define name="title">
        <h:outputText value="#{boardGame.game.name}"/>
    </ui:define>
    <ui:define name="content">
        <h:form id="gameForm">
            <p:remoteCommand name="refreshPage" actionListener="#{boardGame.syncGame}" update="gamePage"/>
            <h:panelGroup id="gamePage">
                <h:panelGroup layout="block" rendered="#{!boardGame.gameLoaded}" styleClass="centerDiv" style="text-align: center;">
                    <h:graphicImage library="images" name="loading.gif"/>
                </h:panelGroup>
                <h:panelGroup layout="block" rendered="#{boardGame.gameLoaded and !logPlay.playMode}">
                    <div style="padding-bottom: 20px;">
                        <p:commandLink actionListener="#{boardGame.refreshGame}" update="gamePage" oncomplete="refreshPage()">Refresh Game</p:commandLink>
                    </div>
                    <div style="padding-bottom: 20px;">
                        <h:outputLink value="#{boardGame.game.gameLink}" target="_blank" style="margin-right: 20px;">BGG Game Page</h:outputLink>
                        <h:outputLink value="#{boardGame.game.forumsLink}" target="_blank">BGG Forums</h:outputLink>
                    </div>
                    <h:panelGroup layout="block">
                        <h:panelGroup layout="block" style="padding-bottom: 10px;" rendered="#{userSession.usernameSet}">
                            <h:link outcome="/plays.xhtml?gameId=#{boardGame.game.id}&amp;faces-redirect=true">Your Plays (#{userSession.userGamesMap.get(boardGame.game.id).numPlays})</h:link>
                            <p:commandLink value="Log Play" process="@this" actionListener="#{logPlay.loadPlay}"
                                           update="gamePage" style="margin-left: 20px;" rendered="#{userSession.loggedIn}"/>
                        </h:panelGroup>
                        <h:panelGroup id="playMessageDiv">
                            <h:panelGroup layout="block" rendered="#{logPlay.showPlayMessage or logPlay.showPlayError}" style="padding-bottom: 10px;">
                                <h:outputText value="#{logPlay.playMessage}" style="color:green;" rendered="#{logPlay.showPlayMessage}"/>
                                <h:outputText value="Error sending play information" style="color:red;" rendered="#{logPlay.showPlayError}"/>
                            </h:panelGroup>
                        </h:panelGroup>
                        <div style="padding-bottom: 20px;">
                            <img src="#{boardGame.game.thumbnailImage}" alt="#{boardGame.game.name} image"/>
                        </div>
                        <h:panelGrid columns="2" columnClasses="boldText smallRightPadding alignTop" style="padding:0;margin:0">
                            <h:outputText value="Name"/>
                            <h:outputText value="#{boardGame.game.name}"/>

                            <h:outputText value="Year Published"/>
                            <h:outputText value="#{boardGame.game.yearPublished}" rendered="#{boardGame.game.yearPublished gt 0}"/>
                            <h:outputText value="N/A" rendered="#{boardGame.game.yearPublished eq 0}"/>

                            <h:outputText value="# Players"/>
                            <h:outputText value="#{boardGame.game.numberOfPlayersString}"/>

                            <h:outputText value="Playing Time"/>
                            <h:outputText value="#{boardGame.game.playingTimeString}"/>

                            <h:outputText value="Your Rating" rendered="#{userSession.loggedIn}"/>
                            <h:panelGroup rendered="#{userSession.loggedIn and ratingView.gameId eq boardGame.game.id}">
                                <h:inputText value="#{ratingView.rating}" required="true" requiredMessage="Rating required" size="3"/>
                                <br/>
                                <p:commandLink process=":gameForm:gamePage" value="Save" action="#{ratingView.saveRating}"
                                                               update=":gameForm:gamePage" style="margin-right: 10px;"/>
                                <p:commandLink process="@this" value="Cancel" action="#{ratingView.cancelChangeRating}" update=":gameForm:gamePage"/>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{userSession.loggedIn and ratingView.gameId ne boardGame.game.id}">
                                <h:outputText value="#{userSession.userGamesMap.get(boardGame.game.id).rating}" rendered="#{userSession.userGamesMap.get(boardGame.game.id).rating gt 0}" style="margin-right: 10px;"/>
                                <h:outputText value="N/A" rendered="#{userSession.userGamesMap.get(boardGame.game.id).rating eq 0}" style="margin-right: 10px;"/>
                                <p:commandLink value="Change" action="#{ratingView.showGameRating(boardGame.game.id, userSession.userGamesMap.get(boardGame.game.id).rating)}"
                                               update=":gameForm:gamePage" styleClass="smallText"
                                               rendered="#{userSession.loggedIn and userSession.userGamesMap.get(boardGame.game.id).collectionId gt 0}" />
                            </h:panelGroup>

                            <h:outputText value="User Avg Rating"/>
                            <h:outputText value="#{boardGame.game.averageRating} (#{boardGame.game.ratings} ratings)"/>

                            <h:outputText value="BGG Rating"/>
                            <h:outputText value="#{boardGame.game.bayesAverageRating}" rendered="#{boardGame.game.bayesAverageRating gt 0}"/>
                            <h:outputText value="N/A" rendered="#{boardGame.game.bayesAverageRating eq 0}"/>

                            <h:outputText value="Rank"/>
                            <h:outputText value="#{boardGame.game.rank}" rendered="#{boardGame.game.rank gt 0}"/>
                            <h:outputText value="N/A" rendered="#{boardGame.game.rank eq 0}"/>

                            <h:outputText value="Categories"/>
                            <h:outputText value="#{boardGame.game.categories}"/>

                            <h:outputText value="Mechanics"/>
                            <h:outputText value="#{boardGame.game.mechanics}"/>
                        </h:panelGrid>
                        <div>
                            <h:outputText value="Description" styleClass="boldText"/>
                        </div>
                        <div>
                            <h:outputText value="#{boardGame.game.escapedDescription}"/>
                        </div>
                        <h:outputText styleClass="boldText" value="Expansions" rendered="#{!empty boardGame.game.expansions}"/>
                        <h:dataTable value="#{boardGame.game.expansions}" var="expansion" rendered="#{!empty boardGame.game.expansions}">
                            <h:column>
                                <h:link outcome="game.xhtml?id=#{expansion.id}"><h:outputText value="#{expansion.name}"/></h:link>
                            </h:column>
                        </h:dataTable>
                        <h:outputText styleClass="boldText" value="Expands" rendered="#{!empty boardGame.game.parentGames}"/>
                        <h:dataTable value="#{boardGame.game.parentGames}" var="parentGame" rendered="#{!empty boardGame.game.parentGames}">
                            <h:column>
                                <h:link outcome="game.xhtml?id=#{parentGame.id}"><h:outputText value="#{parentGame.name}"/></h:link>
                            </h:column>
                        </h:dataTable>
                    </h:panelGroup>
                </h:panelGroup>
                <ui:include src="includes/logPlay.xhtml"/>
            </h:panelGroup>
        </h:form>
    </ui:define>
</ui:composition>
</html>